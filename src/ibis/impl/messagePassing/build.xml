<!DOCTYPE project [
    <!ENTITY sharedProperties SYSTEM "../../../build-properties.xml">
    <!ENTITY nativeTargets    SYSTEM "../../../build-native.xml">
]>

<project
    name="ibis.ipl.impl.messagePassing.native"
    default="build"
    basedir=".">

    <description>
	Compile natives in this directory

	Expect to inherit the following properties:
	    native.dir		the directory of this build
	    ibis		the root of the ibis source tree
	    native-path		${native.dir} relative to ${ibis}
	    build		the root of the ibis build tree
	    default.classpath	a ref property with default classpath

	The shared target definitions require you to define:
	    local.includes	a property that contains include paths specific
				to this module

	Optional:
	    local.lib		the truncated name of the lib you want to create
    </description>

    &sharedProperties;

    <property name="local.lib" value="ibis_mp"/>
    <property name="cc.outtype" value="static"/>

    &nativeTargets;

    <target name="arch-init" depends="property-init">

	<if>
	    <os family="unix"/>
	    <then>
		<property name="panda.arch" value="i386_linux"/>
	    </then>
	<elseif>
	    <os family="windows"/>
	    <then>
		<property name="panda.arch" value="i386_win32"/>
	    </then>
	</elseif>
	<elseif>
	    <os family="mac"/>
	    <then>
		<property name="panda.arch" value="ppc_osX"/>
	    </then>
	</elseif>
	</if>

	<path id="local.includes-ref">
	    <pathelement path="${native.dir}/include"/>
	    <pathelement path="${package.home.panda}/include"/>
	    <pathelement path="${package.home.panda}/include/${panda.arch}/lfc/no_threads"/>
	    <pathelement path="${package.home.daslib}/include"/>
	</path>
	<property name="local.includes" refid="local.includes-ref"/>
	<echo message="local.includes = ${local.includes}"/>
    </target>


    <target name="build" depends="arch-init">
	<antcall target="native-compile"/>
    </target>

</project>
