<project
    name="ibis-natives"
    default="natives"
    basedir=".">

    <description>
	Build natives for Ibis.
	Intended to be used from the main Ibis build.xml file, but separate
	to keep the native stuff out of the way.
    </description>

    <import file="${ibis}/build-files/build-properties.xml"/>
    <import file="${ibis}/build-files/build-native.xml"/>

    <!--
	Compile the native code in all directories that have native code
    -->

    <target name="natives.misc" depends="property-init">
	<ant inheritRefs="false" inheritAll="false" dir="${ibis}/src/ibis/io">
	    <property name="build" value="${build}"/>
	</ant>
	<ant inheritRefs="false" inheritAll="false" dir="${ibis}/3rdparty/omni/OmniTimer">
	    <property name="build" value="${build}"/>
	</ant>
	<ant inheritRefs="false" inheritAll="false" dir="${ibis}/src/ibis/util/nativeCode">
	    <property name="build" value="${build}"/>
	</ant>
    </target>

    <target name="natives.net" depends="property-init" if="gm.present">
	<ant inheritRefs="false" inheritAll="false" dir="${ibis}/src/ibis/impl/net/gm">
	    <property name="build" value="${build}"/>
	</ant>
    </target>

    <target name="natives.mp" depends="property-init" if="panda.present">
	<ant inheritRefs="false" inheritAll="false" dir="${ibis}/src/ibis/impl/messagePassing">
	    <property name="build" value="${build}"/>
	</ant>
	<ant inheritRefs="false" inheritAll="false" dir="${ibis}/src/ibis/impl/messagePassing/panda">
	    <property name="build" value="${build}"/>
	</ant>
	<!--
	<ant inheritRefs="false" inheritAll="false" dir="${ibis}/src/ibis/impl/messagePassing/mpi">
	    <property name="build" value="${build}"/>
	</ant>
	-->
    </target>

    <target name="natives"
	    depends="javah,
		     proprietary-tasks,
		     natives.misc,
	    	     natives.mp,
		     natives.net">
	<delete>
	    <fileset dir="${lib}/natives">
		<include name="**/*.o"/>
	    </fileset>
	</delete>
     </target>
</project>
