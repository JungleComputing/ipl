#!/bin/sh

PRG="$0"

# resolve symlinks
while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
    PRG="$link"
    else
    PRG=`dirname "$PRG"`"/$link"
    fi
done

dir=`dirname "$PRG"`
dir=`cd "$dir" && pwd`

case X$IBIS_HOME in
X)
    IBIS_HOME=`cd "$dir/.." && pwd`
    ;;
esac

export IBIS_HOME

case X$JAVA_HOME in
X)
    JAVA=java
    ;;
*)
    JAVA="$JAVA_HOME/bin/java"
    ;;
esac

export IBIS_HOME

while [ $# -gt 0 ]
do
# echo now inspect argument $1 -- left $#
        case "$1" in
	-cp)
		shift
		CLASSPATH="$1"
		;;
	*)
		break
                ;;
        esac
        shift
done

for i in *
do
    case $i in
    *.jar)
	CLASSPATH="$CLASSPATH:$i"
	;;
    *)
	if [ -d $i ]
	then
	    CLASSPATH="$CLASSPATH:$i"
	fi
	;;
    esac
done

LIBCLASSPATH=""

add_to_libclasspath () {
    DIRLIBS=`cd "$1" && ls *.jar 2>/dev/null`
    for i in ${DIRLIBS}
    do
	if [ -z "$LIBCLASSPATH" ] ; then
	    LIBCLASSPATH="$1/$i"
	else
	    LIBCLASSPATH="$LIBCLASSPATH:$1/$i"
	fi
    done
}

# Add the following dirs to the classpath 
add_to_libclasspath "${IBIS_HOME}"/lib

JAVACLASSPATH="$CLASSPATH:$LIBCLASSPATH"

"$JAVA" -classpath "$JAVACLASSPATH" ibis.frontend.ibis.Ibisc "$@"
